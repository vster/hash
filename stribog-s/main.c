#include <string.h>
#include "main.h"


void self_testing()
{
	unsigned char h512[64], h256[32];
	int i=0, j;

	for(i=0;i<TEST_VECTORS;i++)
	{
		hash_512(Message[i],MessageLength[i],h512);

		printf("Text for hashing = ");
		for(j=0; j<MessageLength[i]/8; j++) 
			printf("%02x ", ((unsigned int) Message[i][j])&0x00ff); 
		printf("\n\n");
		
		printf("Hash 512 = ");
		for(j=0; j<64; j++) 
			printf("%02x ", ((unsigned int) h512[j])&0x00ff); 
		printf("\n\n");
		

		if(memcmp(h512,Hash_512[i],sizeof(unsigned char)*64))
		{
			printf("  SelfTesting: Fail\n");
			printf("    Version: 512\n");
			printf("    Message: %d\n",i);
			printf("    Length: %lld\n",MessageLength[i]);
			return;
		}

		hash_256(Message[i],MessageLength[i],h256);

		printf("Hash 256 = ");
		for(j=0; j<32; j++) 
			printf("%02x ", ((unsigned int) h256[j])&0x00ff); 
		printf("\n\n");

		if(memcmp(h256,Hash_256[i],sizeof(unsigned char)*32))
		{
			printf("  SelfTesting: Fail\n");
			printf("    Version: 256\n");
			printf("    Message: %d\n",i);
			return;
		}
	}
	printf("  SelfTesting: Pass\n");
}

// It is not a cryptographic secure pseudorandom number generator
// 1 < bits < 64
unsigned long long get_random_number(unsigned long long bits)
{
	srand ((unsigned int)time(NULL));
	//  srand(__rdtsc());

    return ( (unsigned long long) ( (((unsigned long long)1<<bits)-(bits == 64 ? 2:1))  * ((long double)rand()/(long double)RAND_MAX) ) ) & ( ((unsigned long long)1<<bits) - (bits == 64 ? 2:1));
}

static unsigned char TextToHashArray[9][100] = {	
	{
		0x32,0x31,0x30,0x39,0x38,0x37,0x36,0x35,0x34,0x33,0x32,0x31,0x30,0x39,0x38,0x37,
		0x36,0x35,0x34,0x33,0x32,0x31,0x30,0x39,0x38,0x37,0x36,0x35,0x34,0x33,0x32,0x31,
		0x30,0x39,0x38,0x37,0x36,0x35,0x34,0x33,0x32,0x31,0x30,0x39,0x38,0x37,0x36,0x35,
		0x34,0x33,0x32,0x31,0x30,0x39,0x38,0x37,0x36,0x35,0x34,0x33,0x32,0x31,0x30
	},
	{
		0xfb,0xe2,0xe5,0xf0,0xee,0xe3,0xc8,0x20,0xfb,0xea,0xfa,0xeb,0xef,0x20,0xff,0xfb,
		0xf0,0xe1,0xe0,0xf0,0xf5,0x20,0xe0,0xed,0x20,0xe8,0xec,0xe0,0xeb,0xe5,0xf0,0xf2,
		0xf1,0x20,0xff,0xf0,0xee,0xec,0x20,0xf1,0x20,0xfa,0xf2,0xfe,0xe5,0xe2,0x20,0x2c,
		0xe8,0xf6,0xf3,0xed,0xe2,0x20,0xe8,0xe6,0xee,0xe1,0xe8,0xf0,0xf2,0xd1,0x20,0x2c,
		0xe8,0xf0,0xf2,0xe5,0xe2,0x20,0xe5,0xd1
	},
	{	0x73,0x65,0x74,0x79,0x62,0x20,0x32,0x33,0x3d,0x68,0x74,0x67,0x6e,0x65,0x6c,0x20,
		0x2c,0x65,0x67,0x61,0x73,0x73,0x65,0x6d,0x20,0x73,0x69,0x20,0x73,0x69,0x68,0x54
	},	
	{	0x73,0x65,0x74,0x79,0x62,0x20,0x30,0x35,0x20,0x3d,0x20,0x68,0x74,0x67,0x6e,0x65,
		0x6c,0x20,0x73,0x61,0x68,0x20,0x65,0x67,0x61,0x73,0x73,0x65,0x6d,0x20,0x6c,0x61,
		0x6e,0x69,0x67,0x69,0x72,0x6f,0x20,0x65,0x68,0x74,0x20,0x65,0x73,0x6f,0x70,0x70,
		0x75,0x53
	},
	{	
		0x00
	},
	{
		0x61
	},
	{
		0x63,0x62,0x61
	},
	{	
		0x74,0x73,0x65,0x67,0x69,0x64,0x20,0x65,0x67,0x61,0x73,0x73,0x65,0x6d
	},
	{	0x67,0x6f,0x64,0x20,0x79,0x7a,0x61,0x6c,0x20,0x65,0x68,0x74,0x20,0x72,0x65,0x76,
		0x6f,0x20,0x73,0x70,0x6d,0x75,0x6a,0x20,0x78,0x6f,0x66,0x20,0x6e,0x77,0x6f,0x72,
		0x62,0x20,0x6b,0x63,0x69,0x75,0x71,0x20,0x65,0x68,0x54
	}};

// Message length in bits
unsigned long long MessageLengthBytes[9] = {
		504,576,256,400,0,8,24,112,344
};

//static unsigned char TextToHashArray[7][100];

int main()
{
	unsigned char h512[64], h256[32];
	int i, j, len;

//	self_testing();
/*
	for ( i = 0; i < 7; i++)
	{
		len = strlen((char *)TextToHashArrayLowEnd[i]);
		for (j = 0 ; j < len; j++)
			TextToHashArray [i][j] = TextToHashArrayLowEnd[i][len - 1 - j];
		TextToHashArray [i][j] = '\0';
	}
*/
	for( i = 0; i < 9 ;i++ )
	{
//		len = strlen((char *)TextToHashArray[i]);
		hash_512(TextToHashArray[i],MessageLengthBytes[i],h512);

		printf("Text for hashing = ");
		for(j = 0; j < MessageLengthBytes[i]/8; j++) 
			printf("%02x ", ((unsigned int) TextToHashArray [i][j])&0x00ff); 
		printf("\n\n");
		
		printf("Hash 512 = ");
		for(j=0; j<64; j++) 
			printf("%02x ", ((unsigned int) h512[j])&0x00ff); 
		printf("\n\n");

		hash_256(TextToHashArray[i],MessageLengthBytes[i],h256);

		printf("Hash 256 = ");
		for(j=0; j<32; j++) 
			printf("%02x ", ((unsigned int) h256[j])&0x00ff); 
		printf("\n\n\n");
	}
	return 0;
}
